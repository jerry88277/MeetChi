# MVP 開發任務文件 (Development Tasks) - Phase 2: 會議記錄、管理後台與音訊優化

本文件將 MVP Phase 2 的開發工作拆分為多個 Sprint，並以 CheckList 形式呈現，以便追蹤開發與測試狀態。

---

## 部署階段一：本機開發與驗證 (Local-Only Deployment) - Completed

(保留歷史記錄，內容略)

---

## 擴充階段：桌面體驗與進階控制 (Desktop Experience & Advanced Control) - Completed

### Sprint 4.5 - Sprint 4.9 (Completed)
(保留歷史記錄，內容略)

---

## 第二階段：會議智慧 (Phase 2: Meeting Intelligence) - New Roadmap

本階段專注於將「即時聽寫工具」升級為完整的「會議記錄系統」，並強化 Web 端能力。

### Sprint 5.1: 資料持久化與歷史列表 (Data Persistence & History) - Completed
- [x] **後端任務 (FastAPI)**:
    - [x] **DB Schema**: 設計 `Meeting`, `TranscriptSegment`, `Summary` 等資料表 (SQLAlchemy)。
    - [x] **API - Create**: 實作 `POST /api/v1/meetings`，用於儲存即時轉錄結束後的完整會議資料。
    - [x] **API - List**: 實作 `GET /api/v1/meetings`，支援分頁 (Pagination) 與關鍵字搜尋。
    - [x] **API - Detail**: 實作 `GET /api/v1/meetings/{id}`，回傳完整逐字稿與摘要。
    - [x] **API - Add Segments**: 實作 `POST /api/v1/meetings/{id}/add_segments`，用於批量新增逐字稿片段。
- [x] **前端任務 (Next.js/Tauri)**:
    - [x] **歷史頁面**: 在 Tauri 中新增「歷史記錄」分頁 (`/history`)。
    - [x] **列表元件**: 實作會議列表 UI，包含標題、時間、時長、狀態標籤。
    - [x] **詳情元件**: 點擊列表項目進入詳情頁，顯示唯讀的逐字稿。
    - [x] **API Client**: 建立 `apps/tauri-client/src/lib/api.ts`。
    - [x] **整合儲存流程**: 在 `apps/tauri-client/src/app/page.tsx` 中，錄音結束時儲存逐字稿。
    - [x] **歷史按鈕**: 在主介面加入「歷史記錄」按鈕。
- [ ] **測試任務**:
    - [ ] 驗證資料庫寫入與讀取的正確性。
    - [ ] 驗證前端分頁功能。

### Sprint 5.2: 離線摘要與模板 (The Brain: Offline Summarization) - Completed
- [x] **後端任務 (FastAPI + LLM Service)**:
    - [x] **LLM Service 擴充**: 在 `llm_service` 中實作 `/summarize` 端點，支援長文本輸入 (Map-Reduce)。
    - [x] **模板引擎**: 實作 `PromptTemplate` 管理，支援 "General", "Sales (BANT)", "HR (STAR)" 等模板。
    - [x] **非同步任務**: 原定使用 Celery，但因開發環境 Redis 問題，實作了基於 `BackgroundTasks` 的本地 Fallback 機制，確保在無 Redis 環境下仍能運作。
    - [x] **API - Trigger**: 實作 `POST /api/v1/meetings/{id}/generate-summary` 手動觸發摘要。
- [x] **前端任務 (Next.js/Tauri)**:
    - [x] **摘要顯示**: 在會議詳情頁右側新增「摘要」面板 (Drawer 形式)。
    - [x] **模板選擇**: 在開始錄音或上傳檔案時，允許使用者選擇「會議類型/模板」。
    - [x] **狀態更新**: 實作輪詢 (Polling) 機制，顯示摘要生成的進度與結果。

### Sprint 5.3: 講者分離 (The Who: Speaker Diarization)
- [ ] **後端任務 (FastAPI)**:
    - [ ] **整合 pyannote.audio**: 引入 `pyannote` 模型 (需 Hugging Face Token)。
    - [ ] **音訊處理**: 實作音訊檔案的預處理 (轉檔為 16kHz Mono WAV)。
    - [ ] **Pipeline**: 在 ASR 轉錄後，執行 Diarization，並將 Speaker Label (SPEAKER_00, SPEAKER_01) 合併回逐字稿 Segment。
- [ ] **前端任務**:
    - [ ] **UI 顯示**: 在逐字稿中顯示「講者標籤」。
    - [ ] **講者編輯**: 允許使用者將 "SPEAKER_00" 重新命名為 "Jerry"。

### Sprint 5.3: 講者分離 (The Who: Speaker Diarization) - Completed
- [x] **後端任務 (FastAPI)**:
    - [x] **整合 pyannote.audio**: 引入 `pyannote` 模型 (需 Hugging Face Token)。
    - [x] **音訊處理**: 實作音訊檔案的預處理 (轉檔為 16kHz Mono WAV)。
    - [x] **Pipeline**: 在 ASR 轉錄後，執行 Diarization，並將 Speaker Label (SPEAKER_00, SPEAKER_01) 合併回逐字稿 Segment (通過 WhisperX 整合)。
- [x] **前端任務**:
    - [x] **UI 顯示**: 在逐字稿中顯示「講者標籤」。
    - [ ] **講者編輯**: (此項移至 Sprint 5.4 詳述)

### Sprint 5.4: 使用者體驗優化與進階控制 (UX & Advanced Control)
本階段專注於提升用戶界面的易用性、歷史記錄管理及摘要生成的靈活性。

- [ ] **UI優化：歷史記錄窗口獨立化** (桌面版):
    - [ ] 確保歷史記錄在桌面版中作為獨立窗口（非透明、有邊框、可拖曳）呈現，風格與設定窗口一致。這將需要修改 `tauri.conf.json` 和 `apps/tauri-client/src/app/page.tsx` 中 `openHistory` 的邏輯。
- [ ] **UI優化：歷史記錄排序** (前端):
    - [ ] 歷史會議列表默認按創建時間（`created_at`）降序排列（最新在最上方）。
- [ ] **歷史記錄管理：刪除功能** (前後端):
    - [ ] **前端**: 在歷史會議列表或詳情頁提供刪除按鈕。
    - [ ] **後端**: 實作 `DELETE /api/v1/meetings/{id}` API，連同相關聯的逐字稿、音訊檔案一併刪除。
- [ ] **摘要進階設定** (前端):
    - [ ] 在會議詳情頁的「生成摘要」按鈕點擊後，提供一個彈出對話框或展開選項，允許用戶設定：
        - [ ] **專有名詞/關鍵字**: 本次會議專屬的額外背景知識（作為 LLM 的即時 Prompt Context）。
        - [ ] **上傳補充圖片 (OCR)**: 允許用戶上傳會議筆記、白板照片。後端需識別內容並由 LLM 判斷是否納入摘要參考。
        - [ ] **講者標籤名稱編輯**: 允許用戶將 `SPEAKER_00` 重命名為 `Jerry` 等實際名稱。
        - [ ] **摘要長度**: 短、中、長選項。
        - [ ] **摘要風格**: 正式、非正式選項。
        - [x] **講者/專有名詞自定義對照表**: 實作前端設定界面，允許用戶定義關鍵字的替換規則。 (後端已實作硬編碼對照表，待前端 UI)
        - [ ] **摘要模板**: (已存在，但需整合到此處的進階設定 UI)。
- [ ] **匯出功能** (前端 & 後端):
    - [ ] **前端**: 在會議詳情頁提供「匯出」按鈕，支持多種格式（TXT, SRT, JSON, PDF, DOCX）。
    - [ ] **後端**: 提供對應的轉換 API。
- [ ] **後端API擴展** (對應前端需求):
    - [ ] **API - Delete Meeting**: 實作 `DELETE /api/v1/meetings/{id}`。
    - [ ] **API - Update Speaker Labels**: 實作 `PATCH /api/v1/meetings/{id}/speakers` (或類似機制)。
    - [ ] **API - Dynamic Summary Options**: 擴展 `POST /api/v1/meetings/{id}/generate-summary` 允許傳遞更多參數。

### Sprint 5.5: Web 端系統音訊採集 (Web System Audio)
- [ ] **目標**: 讓純 Web 用戶端也能具備「系統音訊錄製」能力，作為 Tauri App 的備援方案。
- [ ] **前端任務 (Next.js)**:
    - [ ] **實作 `getDisplayMedia`**: 封裝螢幕分享 API 以獲取系統音訊流。
    - [ ] **音軌提取**: 從 MediaStream 中僅提取 Audio Track，並處理使用者「未勾選分享音訊」的錯誤情況。
    - [ ] **整合 AudioContext**: 將 `getDisplayMedia` 獲取的流送入現有的 AudioWorklet 進行處理 (VAD, 重採樣)。
    - [ ] **UI 切換**: 在「音訊來源」設定中，當環境為純 Web 時，顯示「系統音訊 (透過螢幕分享)」選項。

---

## 部署階段三：GCP 生產環境部署與帳號管控 (Production Deployment & RBAC)

### Sprint 6: 雲端遷移與資安 (Cloud Migration & Security)
- [ ] **任務 (GCP)**:
    - [ ] 撰寫 `apps/backend/Dockerfile` 和 `apps/llm_service/Dockerfile`。
    - [ ] 設置 Cloud Run Service (Sidecar Pattern)。
    - [ ] 設置 Cloud SQL (PostgreSQL)。
- [ ] **任務 (Auth)**:
    - [ ] 整合 NextAuth.js 與 Azure AD。
    - [ ] 實作 RBAC (Role-Based Access Control)。
- [ ] **測試任務**:
    - [ ] 壓力測試與滲透測試。