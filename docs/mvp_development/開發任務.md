# MVP 開發任務文件 (Development Tasks) - Phase 2: 會議記錄、管理後台與音訊優化

本文件將 MVP Phase 2 的開發工作拆分為多個 Sprint，並以 CheckList 形式呈現，以便追蹤開發與測試狀態。

---

## 部署階段一：本機開發與驗證 (Local-Only Deployment)

### Sprint 0: 環境搭建
- [ ] **任務 (全員)**: 安裝 Docker, Node.js, Python 等本地開發環境。
- [ ] **任務 (全端/GCP)**: 編寫 `docker-compose.yml`，整合 FastAPI, 一個模擬 ASR 的服務, 以及 Neon 的本地 Postgres 實例。
- [ ] **任務 (AI)**: 將 `Taiwan-Tongues-ASR-CE` 模型成功容器化。

### Sprint 1: 核心轉錄管線
- [ ] **任務 (全端)**: 實作前端音訊捕獲與 VAD，並建立到後端 FastAPI 的 WebSocket 連線。
- [ ] **任務 (AI/全端)**: 將容器化的 ASR 模型整合進 docker-compose，並讓 FastAPI 能透過 gRPC 與之通訊。
- [ ] **驗收標準**: 開發者可以在瀏覽器上點擊按鈕，終端機（後端日誌）能印出 ASR 服務回傳的「原始」中文逐字稿。

### Sprint 2: 不中斷轉錄與 LLM 潤飾
- [ ] **任務 (AI)**: 使用 **Ollama** 在本地運行一個輕量級 LLM (如 Llama-3-8B)，並設計潤飾 Prompt。建立 LLM 潤飾服務。
- [ ] **任務 (全端)**: 在閘道中整合潤飾服務，並實作「先顯示原始稿，再非同步更新潤飾稿」的機制。
- [ ] **驗收標準**: 在前端介面上，可以看到原始逐字稿出現後，在短時間內被潤飾後的文字替換。使用長度超過 5 分鐘的 YouTube 影片進行測試，轉錄全程不中斷。

### Sprint 3: 雙語功能與 UI
- [ ] **任務 (AI)**: 為 LLM 服務增加翻譯功能。
- [ ] **任務 (全端)**: 完成前端 UI，包括語言切換按鈕、狀態顯示、美觀的逐字稿列表。
- [ ] **驗收標準**: MVP 所有核心功能在本機環境完美運行。

---

## 擴充階段：桌面體驗與進階控制 (Desktop Experience & Advanced Control)

### Sprint 4.7: 前端音訊優化與降噪 (Frontend Audio Optimization & Noise Suppression)
- [ ] **優化任務 (前端 - Next.js)**:
    - [ ] **音訊管線重構**: 將 `apps/frontend/src/app/page.tsx` 中基於 `ScriptProcessorNode` 的音訊處理邏輯，遷移至 `AudioWorklet`。
        - [ ] 創建 `audio-worklet-processor.js` (或 `ts`) 檔案，實作 `AudioWorkletProcessor` 介面。
        - [ ] 在 `page.tsx` 中載入並實例化 `AudioWorkletNode`。
        - [ ] 調整音訊流傳輸機制，確保 AudioWorklet 與主執行緒間的通訊正常 (使用 `port.postMessage`)。
    - [ ] **降噪整合**: 在 `AudioWorkletProcessor` 內部整合 `sapphi-red/web-noise-suppressor` 庫。
        - [ ] 安裝 `sapphi-red/web-noise-suppressor`。
        - [ ] 將 AudioWorklet 接收的音訊數據送入 RNNoise 進行處理。
        - [ ] 將降噪後的音訊數據傳出。
- [ ] **測試任務 (前端)**:
    - [ ] 在不同噪音環境下 (如咖啡廳、辦公室) 測試降噪效果，記錄 ASR 辨識準確度提升情況。
    - [ ] 監控瀏覽器與 Electron 應用程式的 CPU / 記憶體使用率，確保降噪功能不會造成明顯的效能負擔。
    - [ ] 驗證音訊處理的低延遲性，確保不影響即時轉錄體驗。

---

## 第二階段：結構化智慧 (原 Roadmap 第二階段，實際為 Sprint 7 之後)

### Sprint 7: 會議記錄核心功能與歷史儀表板
- [ ] **後端任務 (FastAPI)**:
    - [ ] **非同步任務佇列**: 設置 Celery/Redis 或 FastAPI Background Tasks 處理長時任務。
    - [ ] **CrewAI 整合**: 實作 CrewAI 代理人協作流 (`Map-Reduce-Extract-Verify`)，處理會議逐字稿生成結構化摘要。
    - [ ] **文件匯出 API**: 開發 `GET /api/v1/meetings/{id}/download` API，支援 TXT, SRT, JSON, PDF, DOCX 格式轉換與匯出。
    - [ ] **排程任務**: 設置 Cron Job (或 Cloud Scheduler) 執行資料保留政策檢查與清理。
- [ ] **前端任務 (Next.js)**:
    - [ ] **會議列表頁面**: 開發 `/dashboard/meetings` 頁面，展示所有歷史會議，支援分頁與過濾。
    - [ ] **會議詳情頁面**: 開發 `/dashboard/meetings/{id}` 頁面，展示結構化摘要與原始逐字稿，支援編輯、搜尋、點擊時間戳播放。
    - [ ] **下載功能**: 在會議詳情頁面提供多格式下載按鈕。
    - [ ] **狀態通知**: 接收後端推送的摘要生成狀態通知。
- [ ] **測試任務**:
    - [ ] 驗證 CrewAI 摘要生成功能的準確性與穩定性。
    - [ ] 測試所有文件格式的匯出與下載功能。
    - [ ] 驗證資料保留政策的正確執行。

### Sprint 8: 多媒體上傳與進階整合
- [ ] **後端任務 (FastAPI)**:
    - [ ] **檔案上傳 API**: 開發 `POST /api/v1/meetings/upload`，支援大檔案分段上傳與 GCS (或本地) 儲存。
    - [ ] **上傳後處理**: 觸發非同步任務 (ASR 轉錄、摘要生成)。
- [ ] **前端任務 (Next.js)**:
    - [ ] **上傳介面**: 開發使用者友善的檔案上傳介面，包含進度條與狀態顯示。
    - [ ] **拖曳上傳**: 支援拖曳檔案上傳功能。
- [ ] **測試任務**:
    - [ ] 測試不同格式與大小的音訊/影片檔案上傳與完整處理流程。
    - [ ] 驗證上傳後的逐字稿與摘要的生成準確性。

---

## 部署階段三：GCP 生產環境部署與帳號管控 (Production Deployment & RBAC)

### Sprint 5: 身份驗證、權限管控與雲端遷移
- [ ] **資料庫任務 (後端 - Alembic/SQL)**:
    - [ ] **使用者表**: 創建 `users` 表 (參考功能設計文件中的 Schema)。
    - [ ] **角色表**: 創建 `roles` 表 (或在 `users` 表中新增 `role` 欄位)。
    - [ ] **部門表**: 創建 `departments` 表 (或在 `users` 表中新增 `department` 欄位)。
    - [ ] 撰寫 Alembic 遷移腳本以應用這些變更。
- [ ] **後端任務 (FastAPI)**:
    - [ ] **JWT 驗證**: 實作 JWT 解析與驗證的 Middleware 或 Dependency Injection。
    - [ ] **敏感 API 保護**: 對 `/api/v1/meetings`, `/api/v1/templates`, `/api/v1/users` 等敏感 API 端點應用 JWT 保護。
    - [ ] **使用者相關 API**: 開發獲取使用者資訊 (`GET /api/v1/users/me`)、更新使用者資訊等 API。
    - [ ] **初始管理員**: 編寫一個腳本或後端路由 (僅限開發環境) 用於創建預設的 `admin` 帳號。
- [ ] **前端任務 (Next.js - 身份驗證)**:
    - [ ] **安裝 NextAuth.js**: 安裝 `next-auth` 及其相關套件。
    - [ ] **登入頁面**: 創建 `/auth/signin` 頁面，實作 `Credentials Provider` 進行本地帳號登入 (用於開發測試)。
    - [ ] **Session 管理**: 整合 `SessionProvider`，確保前端可以存取使用者 Session。
    - [ ] **受保護路由**: 實作客戶端與伺服器端 (middleware) 路由保護，確保未登入使用者無法訪問 `/dashboard` 及其他受保護頁面。
- [ ] **前端任務 (Next.js - 管理後台)**:
    - [ ] **UI 框架**: 初始化 `Shadcn/ui`，並配置 Tailwind CSS。
    - [ ] **管理儀表板框架**: 創建 `/dashboard` 頁面與基礎布局 (側邊導航、頂部欄)。
    - [ ] **使用者管理頁面**: 開發 `/dashboard/users` 頁面，展示使用者列表、新增/編輯使用者表單，並支援部門與角色管理。
    - [ ] **模板管理頁面**: 開發 `/dashboard/templates` 頁面，提供可視化的模板編輯器（Form Builder），允許管理員客製化模板的結構。
    - [ ] **角色型路由保護**: 在前端根據使用者角色動態顯示/隱藏導航連結或頁面內容。
- [ ] **雲端遷移任務 (GCP)**: (此部分為計畫書原內容，保持不變，但應與身份驗證同步進行)
    - [ ] 在 **GKE** 上建立 GPU 節點池，並將容器化的 `Taiwan-Tongues-ASR-CE` 部署上去。
    - [ ] 將 Railway 上的 FastAPI 與 LLM 服務遷移至 **Cloud Run** 或 GKE。
    - [ ] 將 Cloudflare Pages 的後端 API 指向 GCP 的負載均衡器。
- [ ] **測試任務**:
    - [ ] 驗證開發階段 `admin` 帳號的登入與管理功能。
    - [ ] 測試不同角色的使用者訪問權限是否正確。
    - [ ] 驗證雲端遷移後，核心服務 (轉錄) 的可用性與穩定性。

### Sprint 6: Azure Entra ID 整合與正式上線
- [ ] **身份驗證任務 (前端 - NextAuth.js)**:
    - [ ] **Azure AD Provider**: 設置 `Azure AD Provider`，配置 Tenant ID, Client ID, Client Secret。
    - [ ] **測試整合**: 完成與 Azure Entra ID 的單點登入 (SSO) 整合測試。
- [ ] **資安任務**:
    - [ ] 執行第三方滲透測試。
    - [ ] 審核系統是否符合相關資安合規性要求。
- [ ] **正式上線準備**:
    - [ ] 準備生產環境部署文檔。
    - [ ] 配置監控與日誌警報。
- [ ] **測試任務**:
    - [ ] 驗證所有功能在 Azure Entra ID 登入下的穩定性。
    - [ ] 進行壓力測試，確保在高併發情境下系統穩定運作。

---

## 第三階段：企業級交付 (原 Roadmap 第三階段)
此階段任務目前主要為資安合規、PII 遮罩、與其他系統整合等，將在未來規劃更詳細的 Sprint。
