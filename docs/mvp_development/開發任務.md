# MVP 開發任務文件 (Development Tasks) - Phase 2: 會議記錄、管理後台與音訊優化

本文件將 MVP Phase 2 的開發工作拆分為多個 Sprint，並以 CheckList 形式呈現，以便追蹤開發與測試狀態。

---

## 部署階段一：本機開發與驗證 (Local-Only Deployment)

### Sprint 0: 環境搭建
- [ ] **任務 (全員)**: 安裝 Docker, Node.js, Python 等本地開發環境。
- [ ] **任務 (全端/GCP)**: 編寫 `docker-compose.yml`，整合 FastAPI, 一個模擬 ASR 的服務, 以及 Neon 的本地 Postgres 實例。
- [ ] **任務 (AI)**: 將 `Taiwan-Tongues-ASR-CE` 模型成功容器化。

### Sprint 1: 核心轉錄管線
- [ ] **任務 (全端)**: 實作前端音訊捕獲與 VAD，並建立到後端 FastAPI 的 WebSocket 連線。
- [ ] **任務 (AI/全端)**: 將容器化的 ASR 模型整合進 docker-compose，並讓 FastAPI 能透過 gRPC 與之通訊。
- [ ] **驗收標準**: 開發者可以在瀏覽器上點擊按鈕，終端機（後端日誌）能印出 ASR 服務回傳的「原始」中文逐字稿。

### Sprint 2: 不中斷轉錄與 LLM 潤飾
- [ ] **任務 (AI)**: 使用 **Ollama** 在本地運行一個輕量級 LLM (如 Llama-3-8B)，並設計潤飾 Prompt。建立 LLM 潤飾服務。
- [ ] **任務 (全端)**: 在閘道中整合潤飾服務，並實作「先顯示原始稿，再非同步更新潤飾稿」的機制。
- [ ] **驗收標準**: 在前端介面上，可以看到原始逐字稿出現後，在短時間內被潤飾後的文字替換。使用長度超過 5 分鐘的 YouTube 影片進行測試，轉錄全程不中斷。

### Sprint 3: 雙語功能與 UI
- [ ] **任務 (AI)**: 為 LLM 服務增加翻譯功能。
- [ ] **任務 (全端)**: 完成前端 UI，包括語言切換按鈕、狀態顯示、美觀的逐字稿列表。
- [ ] **驗收標準**: MVP 所有核心功能在本機環境完美運行。

---

## 擴充階段：桌面體驗與進階控制 (Desktop Experience & Advanced Control)

### Sprint 4.5: 桌面應用與進階設定
- [x] **開發任務 (前端)**: **Initial Prompt 設定介面** - 在網頁版新增設定按鈕，允許使用者輸入並儲存自定義的 `initial_prompt` (如會議主題、專有名詞)，並透過 WebSocket 傳送給後端。
- [x] ~~**開發任務 (桌面端)**: **Electron 專案初始化** - 建立 `apps/desktop`，整合現有 Next.js 前端.~~
- [x] ~~**開發任務 (桌面端)**: **視窗控制與樣式** - 實作 Electron 視窗的「永遠置頂 (Always on Top)」、「半透明背景」與「無邊框拖曳 (Frameless Drag)」功能.~~
- [x] ~~**開發任務 (桌面端)**: **字體大小與透明度控制** - 在前端新增調整 UI 並透過 IPC 控制 Electron 視窗.~~
- [x] ~~**開發任務 (前端/Electron)**: **系統音訊擷取** - 使用 `desktopCapturer` 解決 Electron 下的系統音訊權限問題.~~
- [ ] **測試任務**: 驗證桌面應用的系統音訊抓取能力，以及 `initial_prompt` 對轉錄準確度的影響。

### Sprint 4.6: 沉浸式 UI 重構 (Immersive UI Refactor) - Discarded
- [x] ~~**開發任務 (前端)**: **設定面板分離** - 建立 `SettingsModal` 元件，將音訊來源、語言、Prompt、外觀設定全部移入此模態對話框.~~
- [x] ~~**開發任務 (前端)**: **主視窗重構** - 移除主畫面的控制項，僅保留字幕顯示區與隱藏式 Title Bar.~~
- [x] ~~**開發任務 (前端)**: **Title Bar 互動** - 實作「滑鼠移入顯示 / 移出隱藏」邏輯，並在 Title Bar 上整合錄製、設定與視窗控制按鈕.~~
- [x] ~~**開發任務 (前端)**: **字幕區點擊錄製** - 實作點擊字幕區域切換錄製/暫停的功能，並加入視覺回饋 (如 Play/Pause 圖示).~~
- [x] ~~**開發任務 (前端)**: **顯示行數設定** - 在設定面板新增「最大顯示行數」選項，並透過 CSS/JS 限制字幕區域高度.~~

### Sprint 4.7: Tauri 桌面端遷移 (Tauri Migration) - Completed
- [x] **環境準備**: 安裝 Rust, Tauri CLI, Visual Studio C++ Build Tools。
- [x] **專案初始化**:
    - 建立 `apps/tauri-client` 專案 (使用 `create-tauri-app` + Next.js)。
    - 遷移 `apps/frontend` 的核心 UI 邏輯 (字幕顯示、狀態管理) 到新專案。
- [x] **後端開發 (Rust)**:
    - **視窗管理**: 實作 `main` (Overlay) 與 `settings` (Settings) 多視窗策略。
    - **穿透邏輯**: 實作 `set_ignore_cursor_events` command，實現動態滑鼠穿透與全域快捷鍵 (`Ctrl+Shift+L`) 解鎖。
    - **權限配置**: 修正 `capabilities` 設定，解決視窗拖曳與 API 呼叫權限問題。
    - **UI 優化**: 解決 Windows 11 透明視窗邊框與拖曳區域衝突問題。
    - **基礎音訊**: 整合 `cpal` 並實作 `get_audio_devices` 指令。
- [x] **前端整合 (Next.js)**:
    - 替換 Electron IPC 為 Tauri `invoke` / `listen`。
    - 重構設定頁面為獨立路由 (`/settings`)，並整合 `cpal` 裝置列表。
    - 移除所有 Electron 相關的 Hack 樣式，並採用分離圖層策略解決拖曳問題。
- [x] **驗收標準**:
    - 主視窗完全透明且無邊框 (Windows 11 Resizable artifacts removed)。
    - 滑鼠在字幕區可穿透，透過快捷鍵可恢復互動。
    - 設定視窗可獨立開啟、移動。
    - 前端可成功讀取 Rust 提供的音訊裝置列表。

### Sprint 4.8: Tauri 音訊擷取與 VAD 整合 (Tauri Audio Capture & VAD)
- [ ] **後端開發 (Rust)**:
    - **音訊串流**: 使用 `cpal` 建立 Input Stream，擷取系統音訊 (Loopback) 或麥克風 PCM 數據。
    - **VAD 整合**: 下載並整合 `silero_vad.onnx` 模型，使用 `ort` 進行推論。
    - **緩衝機制**: 實作 Ring Buffer 處理音訊切分。
- [ ] **網路傳輸**:
    - 使用 `tonic` (gRPC) 建立與後端 Cloud Run 的連線。
    - 實作雙向串流 (Bi-directional Streaming)，發送音訊並接收字幕。
- [ ] **測試任務**:
    - 驗證系統音訊錄製的音質與 VAD 準確度。
    - 驗證長時間錄音的穩定性與記憶體佔用。


---

## 第二階段：結構化智慧 (原 Roadmap 第二階段，實際為 Sprint 7 之後)

### Sprint 7: 會議記錄核心功能與歷史儀表板
- [x] **後端任務 (FastAPI)**:
    - [x] **非同步任務佇列**: 設置 Celery/Redis 或 FastAPI Background Tasks 處理長時任務。
    - [x] **CrewAI 整合**: 實作 CrewAI 代理人協作流 (`Map-Reduce-Extract-Verify`)，處理會議逐字稿生成結構化摘要。
    - [ ] **文件匯出 API**: 開發 `GET /api/v1/meetings/{id}/download` API，支援 TXT, SRT, JSON, PDF, DOCX 格式轉換與匯出。
    - [ ] **排程任務**: 設置 Cron Job (或 Cloud Scheduler) 執行資料保留政策檢查與清理。
- [x] **前端任務 (Next.js)**:
    - [x] **會議列表頁面**: 開發 `/dashboard/meetings` 頁面，展示所有歷史會議，支援分頁與過濾。
    - [x] **會議詳情頁面**: 開發 `/dashboard/meetings/{id}` 頁面，展示結構化摘要與原始逐字稿，支援編輯、搜尋、點擊時間戳播放。
    - [x] **下載功能**: 在會議詳情頁面提供多格式下載按鈕。
    - [ ] **狀態通知**: 接收後端推送的摘要生成狀態通知。
- [ ] **測試任務**:
    - [ ] 驗證 CrewAI 摘要生成功能的準確性與穩定性。
    - [ ] 測試所有文件格式的匯出與下載功能。
    - [ ] 驗證資料保留政策的正確執行。

### Sprint 8: 多媒體上傳與進階整合
- [ ] **後端任務 (FastAPI)**:
    - [ ] **檔案上傳 API**: 開發 `POST /api/v1/meetings/upload`，支援大檔案分段上傳與 GCS (或本地) 儲存。
    - [ ] **上傳後處理**: 觸發非同步任務 (ASR 轉錄、摘要生成)。
- [ ] **前端任務 (Next.js)**:
    - [ ] **上傳介面**: 開發使用者友善的檔案上傳介面，包含進度條與狀態顯示。
    - [ ] **拖曳上傳**: 支援拖曳檔案上傳功能。
- [ ] **測試任務**:
    - [ ] 測試不同格式與大小的音訊/影片檔案上傳與完整處理流程。
    - [ ] 驗證上傳後的逐字稿與摘要的生成準確性。

---

## 部署階段三：GCP 生產環境部署與帳號管控 (Production Deployment & RBAC)

### Sprint 5: 身份驗證、權限管控與雲端遷移
- [ ] **資料庫任務 (後端 - Alembic/SQL)**:
    - [ ] **使用者表**: 創建 `users` 表 (參考功能設計文件中的 Schema)。
    - [ ] **角色表**: 創建 `roles` 表 (或在 `users` 表中新增 `role` 欄位)。
    - [ ] **部門表**: 創建 `departments` 表 (或在 `users` 表中新增 `department` 欄位)。
    - [ ] 撰寫 Alembic 遷移腳本以應用這些變更。
- [ ] **後端任務 (FastAPI)**:
    - [ ] **JWT 驗證**: 實作 JWT 解析與驗證的 Middleware 或 Dependency Injection。
    - [ ] **敏感 API 保護**: 對 `/api/v1/meetings`, `/api/v1/templates`, `/api/v1/users` 等敏感 API 端點應用 JWT 保護。
    - [ ] **使用者相關 API**: 開發獲取使用者資訊 (`GET /api/v1/users/me`)、更新使用者資訊等 API。
    - [ ] **初始管理員**: 編寫一個腳本或後端路由 (僅限開發環境) 用於創建預設的 `admin` 帳號。
- [ ] **前端任務 (Next.js - 身份驗證)**:
    - [ ] **安裝 NextAuth.js**: 安裝 `next-auth` 及其相關套件。
    - [ ] **登入頁面**: 創建 `/auth/signin` 頁面，實作 `Credentials Provider` 進行本地帳號登入 (用於開發測試)。
    - [ ] **Session 管理**: 整合 `SessionProvider`，確保前端可以存取使用者 Session。
    - [ ] **受保護路由**: 實作客戶端與伺服器端 (middleware) 路由保護，確保未登入使用者無法訪問 `/dashboard` 及其他受保護頁面。
- [ ] **前端任務 (Next.js - 管理後台)**:
    - [ ] **UI 框架**: 初始化 `Shadcn/ui`，並配置 Tailwind CSS。
    - [ ] **管理儀表板框架**: 創建 `/dashboard` 頁面與基礎布局 (側邊導航、頂部欄)。
    - [ ] **使用者管理頁面**: 開發 `/dashboard/users` 頁面，展示使用者列表、新增/編輯使用者表單，並支援部門與角色管理。
    - [ ] **模板管理頁面**: 開發 `/dashboard/templates` 頁面，提供可視化的模板編輯器（Form Builder），允許管理員客製化模板的結構。
    - [ ] **角色型路由保護**: 在前端根據使用者角色動態顯示/隱藏導航連結或頁面內容。
- [ ] **雲端遷移任務 (GCP)**: (此部分為計畫書原內容，保持不變，但應與身份驗證同步進行)
    - [ ] 在 **GKE** 上建立 GPU 節點池，並將容器化的 `Taiwan-Tongues-ASR-CE` 部署上去。
    - [ ] 將 Railway 上的 FastAPI 與 LLM 服務遷移至 **Cloud Run** 或 GKE。
    - [ ] 將 Cloudflare Pages 的後端 API 指向 GCP 的負載均衡器。
- [ ] **測試任務**:
    - [ ] 驗證開發階段 `admin` 帳號的登入與管理功能。
    - [ ] 測試不同角色的使用者訪問權限是否正確。
    - [ ] 驗證雲端遷移後，核心服務 (轉錄) 的可用性與穩定性。

### Sprint 6: Azure Entra ID 整合與正式上線
- [ ] **身份驗證任務 (前端 - NextAuth.js)**:
    - [ ] **Azure AD Provider**: 設置 `Azure AD Provider`，配置 Tenant ID, Client ID, Client Secret。
    - [ ] **測試整合**: 完成與 Azure Entra ID 的單點登入 (SSO) 整合測試。
- [ ] **資安任務**:
    - [ ] 執行第三方滲透測試。
    - [ ] 審核系統是否符合相關資安合規性要求。
- [ ] **正式上線準備**:
    - [ ] 準備生產環境部署文檔。
    - [ ] 配置監控與日誌警報。
- [ ] **測試任務**:
    - [ ] 驗證所有功能在 Azure Entra ID 登入下的穩定性。
    - [ ] 進行壓力測試，確保在高併發情境下系統穩定運作。

---

## 第三階段：企業級交付 (原 Roadmap 第三階段)
此階段任務目前主要為資安合規、PII 遮罩、與其他系統整合等，將在未來規劃更詳細的 Sprint。