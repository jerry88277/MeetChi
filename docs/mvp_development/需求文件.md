# MVP 需求文件 (Requirements) - Phase 2: 會議記錄與結構化摘要

**版本**: 1.0 (Phase 2)
**日期**: 2025-12-17
**來源**: Consolidated_Project_Plan.md (Section 6.2, 7)

## 1. 核心目標 (Core Objective)
在既有的即時轉錄與沉浸式字幕基礎上，構建**智慧型會議記錄生成系統**。系統需能在會議結束後（或檔案上傳後），利用 **CrewAI** 多代理人協作架構，自動生成具備**治理價值**的結構化會議記錄（如 Sales BANT, HR STAR, R&D Decisions），並支援多格式匯出，將非結構化的對話轉化為可執行的決策數據。

## 2. 第一性原理分析 (First Principles)
- **決策速度 (Decision Velocity)**: 會議記錄的價值不在於「完整記錄每個字」，而在於「多快能轉化為行動」。因此核心是**結構化提取**而非單純摘要。
- **資訊熵減 (Entropy Reduction)**: 原始逐字稿資訊密度低。系統必須透過 Map-Reduce 與特定模板 (Prompting) 有效降低資訊熵，僅保留決策關鍵點。
- **模板即治理 (Template as Governance)**: 不同的會議類型需要不同的結構。模板不只是格式，更是企業工作流程的標準化檢核點。

## 3. MECE 使用者情境分析 (User Scenarios)

### 主要情境 (Happy Path):
- **情境 H-1 (即時會議結束生成)**: 使用者點擊「停止錄製」結束會議。系統彈出「會議總結生成中」提示，背景觸發 CrewAI 流程。數分鐘後，使用者收到通知，可檢視包含「摘要」、「待辦事項」、「決策點」的結構化報告。
- **情境 H-2 (檔案上傳生成)**: 使用者在儀表板點擊「上傳錄音/影片」，選擇檔案並指定會議類型（如「產品週會」）。系統上傳檔案至 GCS (或本地模擬存儲)，觸發處理管線，完成後通知使用者檢視報告。
- **情境 H-3 (模板選擇)**: 在開始錄製或上傳前，使用者從下拉選單選擇「銷售會議 (BANT)」。生成的報告將嚴格遵循 BANT 架構（預算、權限、需求、時程）進行分類。
- **情境 H-4 (互動式編輯)**: 使用者檢視生成報告，發現某個 Action Item 歸屬錯誤。使用者點擊「編輯」模式，修正內容並儲存。
- **情境 H-5 (模板客製化)**: 管理員進入後台「模板管理」頁面，點擊「新增模板」。透過拖拉或表單介面定義欄位名稱（如「客戶痛點」）、類型（列表/文字/布林）與描述。儲存後，一般使用者即可在會議類型中選擇此新模板。

## 4. 功能需求規範 (Functional Requirements)

### 4.1 會議記錄生成 (Meeting Minutes Generation)
- **觸發機制**: 支援「即時轉錄結束」與「檔案上傳」兩種觸發方式。
- **結構化模板**:
    - **通用模板 (General)**: 摘要、重點、待辦事項。
    - **銷售模板 (BANT)**: Budget (預算), Authority (決策權), Need (需求), Timing (時程)。
    - **人資模板 (STAR)**: Situation (情境), Task (任務), Action (行動), Result (結果)。
    - **研發模板 (R&D)**: Decision (決策), Risk (風險), Blocker (障礙)。
    - **動態模板 (Dynamic)**: 支援管理員在後台定義新的模板結構。
- **多代理人協作 (CrewAI)**:
    - **Map (Summarize)**: 分段摘要長會議（若超過 Context Window）。
    - **Reduce (Merge)**: 合併摘要片段。
    - **Extract (Template)**: 根據選定模板提取欄位。
    - **Verify (Governance)**: (進階) 檢查必要欄位完整性。

### 4.2 會議歷史儀表板 (Dashboard)
- **列表檢視**: 顯示所有歷史會議，包含標題、日期、時長、會議類型標籤。
- **詳情頁面**: 
    - **左側**: 結構化摘要顯示區（支援 Markdown 渲染與編輯）。
    - **右側**: 原始逐字稿顯示區（支援搜尋、點擊時間戳跳轉音訊播放）。
- **匯出與下載功能**: 
    - 支援匯出為多種格式：**TXT** (純文字), **SRT** (字幕), **JSON** (完整數據), **PDF** (正式報告), **DOCX** (可編輯文件)。
    - 使用者可直接從詳情頁面下載上述格式檔案。

### 4.3 多媒體上傳與保存 (Media Upload & Retention)
- **即時錄製保存**: 
    - 所有即時錄製的會議音訊與逐字稿皆需自動儲存至資料庫與雲端儲存空間 (GCS)。
    - **保存政策**: 錄音檔與逐字稿預設保留 **6 個月 (半年)**，過期自動封存或刪除（依據後續設定）。
- **使用者上傳**:
    - **格式支援**: 支援常見音訊/影片格式 (mp3, wav, mp4, mkv, mov)。
    - **完整轉錄**: 上傳後自動進行非同步完整轉錄與結構化摘要生成。
    - **下載**: 轉錄完成後，使用者可下載上述所有格式 (txt, srt, json 等) 的逐字稿。

### 4.4 開發優先順序與基礎設施 (Priority & Infrastructure)
- **開發順序**: 
    1. 核心轉錄與摘要功能 (含即時與上傳)。
    2. 歷史儀表板與匯出功能。
- **最後實作**: 登入管理與權限管控 (Auth & RBAC)。
- **資料庫基礎設施**:
    - **正式環境 (Production)**: **GCP Cloud SQL for PostgreSQL**。
    - **本地測試 (Local Dev)**: **PostgreSQL 18** (Dockerized)。

### 4.5 音訊處理優化 (Audio Processing Optimization)
- **前端降噪**: 在客戶端實現即時降噪功能，有效過濾背景雜訊，提升語音清晰度，以達到「AirPods 般」的音質體驗。
- **AudioWorklet 遷移**: 將現有基於 `ScriptProcessorNode` 的音訊處理架構遷移至 `AudioWorklet`，確保音訊處理在高負載下仍能維持流暢且不影響主執行緒效能。

## 5. 資料與狀態 (Data & State)
- **Meeting Object**:
    - `id`: UUID
    - `title`: String (自動生成或使用者輸入)
    - `date`: DateTime
    - `duration`: Number (seconds)
    - `type`: Enum (General, Sales, HR, R&D)
    - `status`: Enum (Processing, Completed, Failed)
    - `transcript`: Array of Segments `[{start, end, text, speaker}]`
    - `summary`: JSON (Structured based on template)
    - `audioUrl`: String (Local path or Cloud URL)
