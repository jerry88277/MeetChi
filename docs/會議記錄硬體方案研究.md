# 會議記錄硬體方案研究報告

## 研究目標
針對會議記錄場景，評估收音硬體選項，並探討如何在現有麥克風/音響系統下進行有效串接，避免「二次收音」造成的音質損失。

---

## 一、硬體選項評估

### 1. 酷樂 CSP-102 會議喇叭

| 項目 | 規格 |
|------|------|
| **收音距離** | 360° 最遠 6 公尺 |
| **AI 降噪** | 內建 AI 智慧降噪 (SNS) |
| **回音消除** | 32KHz 全雙工 AEC |
| **連接方式** | 藍牙 5.0 / USB-C / 3.5mm |
| **喇叭輸出** | 6W，最大 130dB |
| **電池容量** | 5200mAh (20小時通話) |
| **價格區間** | ~NT$ 3,500-4,500 |

**優點：**
- 360° 遠距收音 (LDR 技術)
- 整合喇叭與麥克風，一機多用
- 附贈一年 AI 會議紀錄服務 (Meeting Ink)
- 支援自動音量平衡

**限制：**
- 主要設計為會議通話裝置，Line Out 功能有限
- 適合小型會議室 (6-8人)

---

### 2. 專業會議麥克風比較

| 品牌/型號 | 收音範圍 | 連接方式 | 適用空間 | 價格區間 |
|-----------|----------|----------|----------|----------|
| **Jabra Speak2 55** | 360° 全向 | USB-A/C | 1-6人 | ~NT$ 6,000 |
| **Jabra Speak2 75** | 360° 支援串聯 | USB + BT | 1-8人 | ~NT$ 9,000 |
| **Poly Sync 20** | 全向型 | USB-A/C + BT | 1-6人 | ~NT$ 5,500 |
| **Poly Sync 40** | 全向型，可串接 | USB-A/C + BT | 中型室 | ~NT$ 9,000 |
| **Poly Sync 60** | 6陣列麥克風 | USB + BT，雙機串聯 | 中大型室 | ~NT$ 18,000 |
| **Konftel 300** | 360°，擴充麥克風 | USB + 類比 | 12-20+人 | ~NT$ 25,000 |

**推薦：**
- **小會議室 (4-8人)**: Jabra Speak2 55 或 Poly Sync 20
- **中型會議室 (8-15人)**: Poly Sync 40 或 Jabra Speak2 75
- **大型會議室 (15+人)**: Poly Sync 60 雙機串聯 或 Konftel 300 + 擴充麥克風

---

## 二、音訊串接方案分析

### 問題核心：避免「二次收音」

❌ **不建議的方式** (物理傳遞)：
```
原有麥克風 → PA 系統 → 喇叭播放 → 會議記錄麥克風收音 → 錄音系統
```
- 音質大幅衰減
- 環境噪音疊加
- 回音/殘響問題
- 收音距離限制

✅ **建議的方式** (數位/類比直連)：
```
原有麥克風 → PA 系統/混音器 → Line Out 分接 → 會議記錄系統
                          ↓
                     原有喇叭 (持續正常運作)
```

---

### 方案 A：Line Out 分接 (簡易方案)

**設備需求：**
1. **音訊分配器 (Distribution Amplifier)** - 推薦使用主動式
   - Art SplitMix 4 (~NT$ 3,500)
   - Behringer HA400 (~NT$ 800)
   
2. **USB 錄音介面**
   - Focusrite Scarlett Solo (~NT$ 3,500) - 簡單單軌
   - Focusrite Vocaster One (~NT$ 5,000) - 專為語音優化
   - Zoom H6 (~NT$ 10,000) - 多軌獨立錄音

**連接方式：**
```
混音器/PA 主輸出
       ↓
  Line Out (XLR/TRS/RCA)
       ↓
  主動式音訊分配器
       ↓          ↘
  原有音響系統     USB 錄音介面 → 電腦/MeetChi 系統
```

**優點：**
- 不干擾原有系統運作
- 獲得最高品質音訊 (線路電平)
- 成本相對低

**注意事項：**
- 確認阻抗匹配
- 使用高品質線材
- 調整錄音介面增益，避免過載

---

### 方案 B：數位直出 (專業方案)

如果原有系統為數位混音器 (如 Yamaha TF / Allen & Heath dLive)：

**設備需求：**
- 數位混音器的 USB/Dante 輸出
- 或 Dante AVIO 轉換器 (~NT$ 10,000)

**連接方式：**
```
數位混音器 → USB/Dante → 電腦 DAW → MeetChi 系統
```

**優點：**
- 零品質損失 (數位傳輸)
- 可選擇性錄製特定通道
- 支援多軌錄音

---

### 方案 C：AUX Send 專用輸出 (最佳實踐)

**概念：** 在混音器上建立一個專用的 AUX Send，只發送麥克風訊號到錄音系統，不包含喇叭播放的內容。

**連接方式：**
```
麥克風 1 ─┬─→ Main Out → PA 系統/喇叭
麥克風 2 ─┤
麥克風 3 ─┴─→ AUX Send → USB 錄音介面 → MeetChi
```

**優點：**
- 完全隔離 (無回授風險)
- 可獨立調整錄音混音
- 高度靈活

---

### 方案 D：雙系統並行 (完全獨立)

**適用場景：** 無法修改現有 PA 系統，或需要獨立可攜式解決方案

**設備需求：**
1. 專用全向會議麥克風 (如 Poly Sync 60 或 CSP102)
2. 放置於會議桌中央
3. 直接 USB 連接至 MeetChi 系統

**連接方式：**
```
現有 PA 系統 (獨立運作，負責會議擴音)

會議麥克風 [Poly Sync 60] → USB → 電腦 → MeetChi
   ↑
(放置於桌面中央，專門收會議)
```

**優點：**
- 完全不影響現有系統
- 快速部署
- 適合不同場地流動使用

**缺點：**
- 需要適當的桌面擺放位置
- 大型場地可能需要多個設備串聯

---

## 三、綜合建議

### 依場景選擇

| 場景 | 推薦方案 | 推薦設備 |
|------|----------|----------|
| **小會議室 (4-8人)** | 方案 D (獨立麥克風) | CSP102 或 Jabra Speak2 55 |
| **中型會議室 (8-15人)** | 方案 A (Line Out) 或 方案 D | Poly Sync 40 或 Line 分接 |
| **大型會議室 (15+人)** | 方案 A/C (混音器整合) | Poly Sync 60 × 2 或 AUX Send |
| **講座/大禮堂** | 方案 A/B (PA 系統輸出) | 錄音介面 + 分配器 |

---

### 快速實施清單

**如果要快速開始 (預算 NT$ 10,000 以內)：**

1. **獨立收音方案：**
   - 酷樂 CSP102 (~NT$ 4,000) 
   - USB 直連電腦

2. **Line Out 分接方案：**
   - 3.5mm Y 型分接線 (~NT$ 200)
   - Focusrite Scarlett Solo (~NT$ 3,500)
   - 接在現有擴音系統 Line Out

**如果需要專業品質 (預算 NT$ 20,000+)：**

1. **設備：**
   - Poly Sync 60 (~NT$ 18,000)
   - 或 Zoom H6 (~NT$ 10,000) + AUX Send 連接

2. **優勢：**
   - 專業級收音品質
   - 多軌錄音能力
   - 遠距離清晰收音

---

## 四、MeetChi 系統整合考量

### 音訊輸入方式

MeetChi 系統目前支援：
1. **Tauri 客戶端**: 系統音訊輸入 (通過 USB 收音裝置)
2. **Web 端上傳**: 音檔上傳進行離線轉譯

### 建議的整合流程

```
會議收音設備 (USB) 
      ↓
  電腦音訊輸入
      ↓
  MeetChi Tauri Client (即時 STT)
      ↓
  後端 API (WhisperX + LLM 摘要)
      ↓
  會議記錄輸出
```

### 音訊格式建議

| 參數 | 建議值 |
|------|--------|
| 取樣率 | 16kHz 或 44.1kHz |
| 位元深度 | 16-bit |
| 聲道 | Mono (單聲道) 或 Stereo |
| 格式 | WAV 或 高位元率 MP3 |

---

## 五、大型場地解決方案 (100-300人)

### 場景需求
- **大型會議室** (100人) 或 **演講廳** (300人)
- 現有專業 PA/麥克風系統
- 任意電腦可串接
- 透過瀏覽器串流至 Cloud Run 後端

---

### 🎯 推薦解決方案：可攜式 USB 音訊介面 + 瀏覽器即時串流

#### 整體架構圖

```
┌─────────────────────────────────────────────────────────────────┐
│                    大型會議室 / 演講廳                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   [無線麥克風] ─┐                                                │
│   [講台麥克風] ─┼─→ [專業混音器/PA系統] ─→ [喇叭] (現場擴音)       │
│   [桌面麥克風] ─┘           │                                    │
│                           │                                     │
│                      Line Out / AUX Send                        │
│                           │                                     │
│                           ▼                                     │
│            ┌─────────────────────────────┐                      │
│            │  USB 音訊介面 (可攜式)        │                      │
│            │  • Focusrite Scarlett 2i2   │                      │
│            │  • Roland Rubix22           │                      │
│            │  • Behringer UMC202HD       │                      │
│            └─────────────┬───────────────┘                      │
│                         USB                                     │
│                          │                                      │
│                          ▼                                      │
│            ┌─────────────────────────────┐                      │
│            │       任意筆電/電腦          │                      │
│            │   (作為音訊串流終端)         │                      │
│            └─────────────┬───────────────┘                      │
│                          │                                      │
└──────────────────────────│──────────────────────────────────────┘
                           │ 瀏覽器 (Chrome/Edge)
                           │ Web Audio API + WebSocket
                           │
                    ┌──────▼──────┐
                    │   網際網路    │
                    └──────┬──────┘
                           │
                    ┌──────▼──────┐
                    │  Cloud Run   │
                    │   MeetChi    │
                    │   Backend    │
                    └──────┬──────┘
                           │
                    ┌──────▼──────┐
                    │ WhisperX STT │
                    │ + LLM 摘要   │
                    └─────────────┘
```

---

### 硬體清單與預算

#### 必要設備

| 設備 | 推薦型號 | 價格 | 說明 |
|------|----------|------|------|
| **USB 音訊介面** | Focusrite Scarlett 2i2 (4th Gen) | NT$ 4,500 | 專業級，低延遲，XLR/TRS Combo |
| (替代方案) | Roland Rubix22 | NT$ 5,500 | 金屬機身，超低噪音 |
| (預算方案) | Behringer UMC202HD | NT$ 2,500 | CP 值高，MIDAS 前級 |
| **連接線材** | XLR to XLR (平衡式) | NT$ 300-500 | 從混音器 Line Out 到介面 |
| (備用) | TRS to TRS 6.3mm | NT$ 200-400 | 如果 PA 系統是 TRS 輸出 |

#### 選配設備

| 設備 | 推薦型號 | 價格 | 說明 |
|------|----------|------|------|
| **主動式分配器** | Art SplitMix 4 | NT$ 3,500 | 避免影響原有音響系統 |
| **USB Hub** | 供電式 USB 3.0 Hub | NT$ 500 | 確保穩定供電 |
| **延長線** | USB-C 延長線 (5m) | NT$ 300 | 增加擺放彈性 |

**總預算估計：NT$ 5,000 - 10,000**

---

### 軟體/網頁端實作

#### 瀏覽器音訊擷取 (前端)

```javascript
// MeetChi Web Client - 音訊串流模組
class AudioStreamer {
  constructor(websocketUrl) {
    this.ws = new WebSocket(websocketUrl);
    this.audioContext = null;
    this.mediaStream = null;
  }

  async start() {
    // 1. 取得 USB 音訊介面的輸入 (會列為系統音訊裝置)
    this.mediaStream = await navigator.mediaDevices.getUserMedia({
      audio: {
        // 選擇特定音訊裝置
        deviceId: { ideal: 'usb-audio-interface-device-id' },
        // 優化設定
        echoCancellation: false,  // 已在硬體處理
        noiseSuppression: false,  // 保留原始音質
        autoGainControl: false,
        sampleRate: 16000         // WhisperX 最佳
      }
    });

    // 2. 建立音訊處理管線
    this.audioContext = new AudioContext({ sampleRate: 16000 });
    const source = this.audioContext.createMediaStreamSource(this.mediaStream);
    
    // 3. 使用 AudioWorklet 處理音訊並串流
    await this.audioContext.audioWorklet.addModule('/audio-processor.js');
    const processor = new AudioWorkletNode(this.audioContext, 'audio-processor');
    
    processor.port.onmessage = (event) => {
      // 4. 透過 WebSocket 發送音訊資料到 Cloud Run
      if (this.ws.readyState === WebSocket.OPEN) {
        this.ws.send(event.data);
      }
    };
    
    source.connect(processor);
  }

  // 列出可用的音訊輸入裝置
  static async listAudioDevices() {
    const devices = await navigator.mediaDevices.enumerateDevices();
    return devices.filter(d => d.kind === 'audioinput');
  }
}
```

#### 裝置選擇 UI

```html
<!-- 音訊裝置選擇介面 -->
<div class="audio-source-selector">
  <label>選擇音訊輸入裝置：</label>
  <select id="audioDeviceSelect">
    <!-- 會列出 USB 音訊介面 -->
    <option value="default">預設麥克風</option>
    <option value="usb-interface">Focusrite Scarlett 2i2</option>
    <option value="usb-interface-2">Roland Rubix22</option>
  </select>
  
  <button onclick="startRecording()">開始會議記錄</button>
  
  <!-- 即時音量指示器 -->
  <div class="volume-meter">
    <div class="level" id="audioLevel"></div>
  </div>
</div>
```

---

### Cloud Run 後端整合

#### WebSocket 接收端點

```python
# apps/backend/app/routers/audio_stream.py
from fastapi import WebSocket
import asyncio
import numpy as np

@router.websocket("/ws/audio-stream")
async def audio_stream_endpoint(websocket: WebSocket):
    await websocket.accept()
    
    audio_buffer = []
    
    try:
        while True:
            # 接收音訊 chunk (16-bit PCM, 16kHz)
            data = await websocket.receive_bytes()
            audio_buffer.append(np.frombuffer(data, dtype=np.int16))
            
            # 每累積 5 秒音訊進行一次轉譯
            if len(audio_buffer) >= 80:  # 16000 * 5 / 1000 chunks
                audio_data = np.concatenate(audio_buffer)
                
                # 呼叫 WhisperX 進行 STT
                result = await transcribe_audio(audio_data)
                
                # 回傳即時轉譯結果
                await websocket.send_json({
                    "type": "transcript",
                    "text": result["text"],
                    "segments": result["segments"]
                })
                
                audio_buffer = []
                
    except Exception as e:
        print(f"WebSocket error: {e}")
    finally:
        await websocket.close()
```

---

### 部署流程

#### 現場設置 SOP

```
1. 確認場地 PA 系統
   □ 找到混音器/調音台
   □ 確認 Line Out 或 AUX Send 輸出位置
   □ 確認輸出接頭類型 (XLR / TRS / RCA)

2. 連接硬體
   □ 將 USB 音訊介面連接到筆電
   □ 使用適當線材從 PA 系統 Line Out 連接到介面 Line In
   □ 確認介面的增益旋鈕在合適位置 (12點鐘方向開始調整)

3. 軟體設定
   □ 開啟 Chrome 瀏覽器
   □ 進入 MeetChi Web 介面 (https://meetchi.example.com)
   □ 在裝置選擇中選擇 USB 音訊介面
   □ 確認音量指示器有反應

4. 開始錄製
   □ 點擊「開始會議記錄」
   □ 確認即時轉譯開始運作
   □ 會議結束後點擊「結束並儲存」
```

---

### 常見 PA 系統接線指南

| PA 系統類型 | 輸出接頭 | 需要的線材 | 接到 USB 介面 |
|------------|----------|------------|--------------|
| **Yamaha TF/QL 數位混音器** | XLR 主輸出 | XLR to XLR | Combo Jack (XLR) |
| **Allen & Heath ZED** | TRS 主輸出 | TRS to TRS | Combo Jack (TRS) |
| **Behringer X32** | XLR / AES 輸出 | XLR to XLR | Combo Jack (XLR) |
| **小型擴大機** | RCA 輸出 | RCA to TRS 轉接 | Line In (TRS) |
| **無線麥克風接收器** | XLR 輸出 | XLR to XLR | Combo Jack (XLR) |

---

### 優缺點分析

#### ✅ 優點
1. **通用性高** - 任何電腦 + 瀏覽器即可使用
2. **成本低** - 只需一個 USB 音訊介面 (NT$ 2,500-5,500)
3. **不影響現有系統** - 使用 Line Out/AUX Send 分接
4. **專業音質** - 直接取得混音後的訊號，比麥克風收音好
5. **即時串流** - 瀏覽器直接傳送到 Cloud Run

#### ⚠️ 注意事項
1. 需要穩定的網路連線 (建議 > 2Mbps 上傳)
2. 首次需進行增益調整以避免過載
3. 需要瀏覽器授權麥克風/音訊輸入權限

---

## 六、結論

### 依場景推薦

| 場景 | 推薦方案 | 硬體成本 |
|------|----------|----------|
| **小會議室 (4-8人)** | 酷樂 CSP102 + USB 直連 | NT$ 4,000 |
| **中型會議室 (8-15人)** | Poly Sync 40 或 Line Out 分接 | NT$ 5,000-9,000 |
| **大型會議室 (100人)** | USB 音訊介面 + PA Line Out | NT$ 5,000 |
| **演講廳 (300人)** | USB 音訊介面 + 混音器 AUX Send | NT$ 5,000 |

### 核心原則

1. **直接取得音訊** - 從 PA 系統 Line Out 或 AUX Send 取得，避免二次收音
2. **USB 音訊介面** - 作為「橋接器」將專業音訊轉為電腦可用格式
3. **瀏覽器串流** - 使用 Web Audio API + WebSocket 傳送到 Cloud Run
4. **即時處理** - WhisperX 在後端進行即時轉譯並回傳結果

